---
trigger: always_on
---

# 错误自动检测和记录规则

## 重要说明
**Roo 规则系统的局限性**：本规则文件是 AI 行为的指导意见，但 Roo 规则系统**无法真正拦截工具执行结果**。错误的自动检测和记录依赖于 AI 的**自我监控**和**自觉遵守**规则。

## 触发条件
当 Roo 执行命令或工具调用出现以下情况时，**AI 应该**自动触发错误记录：

1. **命令执行失败**：`execute_command` 工具返回非零退出码
2. **文件操作错误**：`read_file`、`write_to_file`、`apply_diff` 等工具操作失败
3. **语法错误**：用户提到"语法错误"、"命令错误"、"执行失败"等关键词
4. **工具调用异常**：任何工具调用返回错误信息

## AI 自我监控要求
AI 必须在每次工具调用后：

1. **检查结果**：确认工具调用是否成功
2. **识别错误**：当检测到错误时，分析错误类型、描述、原因
3. **主动记录**：调用 `skill(skill="ai-error-record", args="...")` 记录错误
4. **诚实报告**：不得在未完成任务时声称"任务完成"

## 在响应生成前的最终检查
在调用 `attempt_completion` 之前，AI 必须执行以下检查：

1. **确认所有子任务已完成**
2. **确认所有测试都通过**
3. **确认没有未处理的错误**
4. **确认用户没有未解决的反馈**

**如果存在未完成的子任务或错误，不得调用 attempt_completion，不得声称"任务完成"**

## 使用示例

### 命令执行失败后的正确操作
```python
# 执行命令后，AI 应该检查结果
# 如果命令失败（退出码非 0），AI 应该：
skill(skill="ai-error-record", args="error_type=命令执行错误; error_description=命令执行失败; root_cause=命令语法或参数错误; solution=检查命令语法和参数")
```

### 文件操作错误后的正确操作
```python
# 当文件操作失败时，AI 应该：
skill(skill="ai-error-record", args="error_type=文件操作错误; error_description=尝试读取不存在的文件; root_cause=文件路径错误或文件不存在; solution=验证文件路径存在性后再操作")
```

## 注意事项
1. **避免重复记录**：同一错误只记录一次
2. **简洁描述**：错误描述应简洁明了
3. **实用解决方案**：提供可操作的解决方案建议
4. **不影响主流程**：错误记录不应中断主要任务流程
5. **诚实报告**：在未完成任务或测试失败时，不得声称"任务完成"

## 已知局限性
- 规则系统依赖 AI 自觉遵守，没有强制触发机制
- AI 需要主动检查结果并调用技能，不会自动拦截
- 用户需要监督 AI 是否遵守了规则